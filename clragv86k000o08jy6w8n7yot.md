---
title: "Day 75&76 - Sending Docker Log to Grafana  & Build a Grafana dashboard"
datePublished: Fri Jan 12 2024 09:59:21 GMT+0000 (Coordinated Universal Time)
cuid: clragv86k000o08jy6w8n7yot
slug: day-7576-sending-docker-log-to-grafana-build-a-grafana-dashboard
cover: https://cdn.hashnode.com/res/hashnode/image/upload/v1705047470831/6ed78476-ae0f-40bd-a3d9-90665cb9a2a5.jpeg

---

## Task:

* Install *Docker* and start docker service on a Linux EC2 through [USER DATA](https://github.com/LondheShubham153/90DaysOfDevOps/blob/0999394e87192863b5c190a90896249c31ce31af/2023/day39/tasks.md) .
    
* Create 2 Docker containers and run any basic application on those containers (A simple todo app will work).
    
* Now intregrate the docker containers and share the real time logs with Grafana (Your Instance should be connected to Grafana and Docker plugin should be enabled on grafana).
    
* Check the logs or docker container name on Grafana UI.
    

1. Now, we will create 2 docker containers
    

```plaintext
docker run -d -p 8001:8001 karanidnani6/django-todo:latest
docker run -d nginx
# also you can restart the loki container
docker ps -a 
docker restart <container_name_or_id>
```

1. Integrating Docker containers with Grafana involves collecting and visualizing logs and metrics generated by Docker containers. In this scenario, we'll use Telegraf as the data collector, InfluxDB as the time-series database, and Grafana for log visualization.
    
2. This will be explained in the Grafana UI below.
    

### ***Configure a data source in Grafana***

by adding Loki, as previously demonstrated in the referenced article. After completing this step, proceed to the Explore section to generate metrics.

[**Click Here**](https://hashnode.com/post/clqnfjl4y000m08jz5ol89mdw)

In this process, we aim to create metrics that specifically highlight logs containing the term "Docker."

Follow these steps:

1. Open the Explore section.
    
2. Create a metric with the following specifications:
    
    * ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703699087396/723af7ff-939a-416a-b992-9897b17bc172.png?auto=compress,format&format=webp align="left")
        
        Label Filters: jobs, varlogs
        
    * Line Contains: docker
        
3. Execute the query by clicking on "Run Query."
    
4. ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703699047176/c87ce4cf-699e-4d1c-afa2-aa9fb3631e69.png?auto=compress,format&format=webp align="left")
    
    Once you obtain the desired output, organize the results into a new dashboard. Prior to this, assign the name "Docker Logs" to the upcoming dashboard.
    

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703699056368/85fe75fb-3fcc-405f-8bb3-22b1056a3244.png?auto=compress,format&format=webp align="left")

### ***Setting up Telegraf***

It is a crucial step in establishing a robust data collection system for monitoring, observability, and performance analysis. Telegraf serves as a cornerstone for creating scalable and efficient monitoring solutions in diverse environments.

Follow these steps to configure Telegraf on your EC2 instance:

Install Telegraf through the apt package manager:

```plaintext
sudo apt-get install telegraf
```

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703779998149/f585fcab-2065-4c8f-a1b2-e54cbd8f09be.png?auto=compress,format&format=webp align="left")

Verify the status of the Telegraf service:

```plaintext
sudo systemctl status telegraf
```

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703780012209/f3e80021-c96e-4e31-b218-6bdf61123eaf.png?auto=compress,format&format=webp align="left")

Modify the Telegraf configuration file to enable the collection of Docker logs:

```plaintext
sudo vim /etc/telegraf/telegraf.conf
```

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703780034355/08cfd79f-93d9-49ad-90c2-9b8b0cc8ff2a.png?auto=compress,format&format=webp align="left")

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703780047382/f47f5035-c1b6-4239-b821-0232d890c293.png?auto=compress,format&format=webp align="left")

After making the necessary changes, restart the Telegraf service and verify its status:

```plaintext
sudo service telegraf restart
sudo service telegraf status
```

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703780064446/c61b509f-c6b5-4fb9-a7e6-9a38da770c45.png?auto=compress,format&format=webp align="left")

To ensure proper permissions, grant access to the Docker socket:

```plaintext
sudo chmod 666 /var/run/docker.sock
```

These steps will effectively configure Telegraf on your EC2 instance, allowing it to collect Docker logs and contribute to a comprehensive monitoring solution.

### ***Configuring InfluxDB***

To establish the backend storage for Telegraf, follow the steps below for configuring InfluxDB on your EC2 instance:

Install InfluxDB using the Ubuntu apt package manager:

```plaintext
sudo apt install influxdb
```

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778796156/8457eaa0-21ab-4237-ab61-520420270d3b.png?auto=compress,format&format=webp align="left")

Download the InfluxDB client:

```plaintext
sudo apt install influxdb-client
```

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778801359/c2834b78-5af4-41c8-8b60-ef4de534e19f.png?auto=compress,format&format=webp align="left")

Open the InfluxDB shell by executing the following command in your terminal:

```plaintext
influx
```

Within the InfluxDB shell, create the "telegraf" database using the following command:

```plaintext
CREATE DATABASE telegraf
```

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778805012/c48eea7a-b49f-4c48-8eeb-03c176d11171.png?auto=compress,format&format=webp align="left")

Navigate to the Telegraf configuration file and enable the database configuration to establish the connection between Telegraf and InfluxDB:

```plaintext
vim /etc/telegraf/telegraf.conf
```

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778807172/1e9e3c66-ae0b-40cf-a1c9-9a708ffcff27.png?auto=compress,format&format=webp align="left")

After making the necessary changes, restart the Telegraf service to apply the configuration updates:

```plaintext
sudo service telegraf restart
```

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778809851/da80bb14-ddc0-437f-a33e-28d4a351f0b1.png?auto=compress,format&format=webp align="left")

By following these steps, you've effectively configured InfluxDB as the backend storage for Telegraf, allowing you to store and analyze time series data for monitoring, performance analysis, and observability of your systems and applications.

### Dashboard Creation and Configuration

#### Before creation Configure the data source in Grafana which we have installed in the above steps:

Open Grafana and navigate to the Data Sources section.

1. Add a new data source, select "InfluxDB," and enter the InfluxDB URL (e.g., [`http://localhost:8086`](https://pmgoriya.hashnode.dev/sending-docker-log-to-grafana#heading-configure-a-data-source-in-grafana)).
    
2. ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778617895/76829806-c348-449a-990b-5c4554440290.png?auto=compress,format&format=webp align="left")
    
    Set the database name to "Telegraf" and configure authentication if needed.
    
3. Click "Save & Test" to confirm the connection.
    

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778620414/e9f3ca54-f057-400d-b562-93a73f86686f.png?auto=compress,format&format=webp align="left")

Now, InfluxDB is configured as a data source in Grafana with the Telegraf database.

#### Creating the Dashboard: Displaying Key Metrics

We will create a comprehensive dashboard with the following data:

1. **Total Containers:**
    
    * Choose the data source as InfluxDB.
        
    * In the FROM section, select docker to configure Docker data.
        
    * In the SELECT section, choose n\_containers to show the total number of containers on the server.
        
        ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778664167/00be673e-c3e2-44ff-991b-f975d9cc636b.png?auto=compress,format&format=webp align="left")
        
2. **Running Containers:**
    
    * Choose the data source as InfluxDB.
        
    * In the FROM section, select docker to configure Docker data.
        
    * In the SELECT section, choose n\_containers\_running to display the total number of running containers on the server.
        
        ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778656097/cf502d42-81a1-4740-a897-49534caaf8a3.png?auto=compress,format&format=webp align="left")
        
3. **Stopped Containers:**
    
    * Choose the data source as InfluxDB.
        
    * In the FROM section, select docker to configure Docker data.
        
    * In the SELECT section, choose n\_containers\_stopped to show the total number of stopped containers on the server.
        
        ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778661186/a9e1d816-ee0b-4bcc-b412-c5075b8fb634.png?auto=compress,format&format=webp align="left")
        
4. **Images:**
    
    * Choose the data source as InfluxDB.
        
    * In the FROM section, select docker to configure Docker data.
        
    * In the SELECT section, choose n\_images to display the total number of images on the server.
        
        ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778658699/96637957-ec7c-4e34-99f7-331ad94d2e2f.png?auto=compress,format&format=webp align="left")
        
5. **Containers Memory:**
    
    * Choose the data source as InfluxDB.
        
    * In the FROM section, select docker to configure Docker data.
        
    * In the SELECT section, choose field(usage\_percent) & last(). This shows the usage percentage of containers last used according to the set time.
        
        ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778666885/8028d259-c4fa-4b20-8859-b937cd444485.png?auto=compress,format&format=webp align="left")
        
6. **Containers Uptime:**
    
    * Choose the data source as InfluxDB.
        
    * In the FROM section, select docker to configure Docker data.
        
    * In SELECT, choose field(uptime\_ns) last() alias(uptime\_ns). This displays the uptime of each container currently running on the server.
        
        ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778670876/58edd536-0a2d-4896-908d-a13a8ffa02e3.png?auto=compress,format&format=webp align="left")
        

#### Finalizing the Dashboard

Finally, add all the individual unit graphs and tables to the dashboard. Your comprehensive dashboard is now ready for monitoring various aspects of your Docker environment!

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703778675596/215aefd7-58ce-41a2-9ef6-46b90a7805b5.png?auto=compress,format&format=webp align="left")